// version 1.0
#include <SPI.h>
#include <RFID.h>
#define SS_PIN 10
#define RST_PIN 9
RFID rfid(SS_PIN, RST_PIN);
uint32_t myTimer1; //Таймер
int dinam = 3;
int zvyk = 1;
int serNum0;
int serNum1;
int klass[] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11}; //0,1,2,3,4,5,6,7,8,9,10,11,12
int KL;
int i1 = 1;//Круг первого
int i2 = 1;//Круг второго
int k = 0;//Количество учеников
int UID[] = {199, 89}; //Верные айди
int vg[] = {0, 0}; //Пропуски
int vg0;
int vg1;
const char *bykva[]  = {
  "А",   // 0
  "Б",     // 1
  "В",     // 2
};


String IM;
String BK;
String FAM;
void setup()
{
  Serial.begin(9600);
  SPI.begin();
  rfid.init();
  Serial.read();

}


void loop()
{



  // Если обнаружена карта
  {
    if (rfid.isCard()) {
      delay(250);

      // Считываем адрес
      if (rfid.readCardSerial()) {


        // Выводим его в порт в десятичном представлении
      }
    }
    rfid.halt();

  }
  if (rfid.serNum[0] == UID[0] and i1 < 2) {
    while (rfid.serNum[0] == UID[0] and i1 < 2) {
      FAM = "Демченко";
      IM = "Илья";
      KL = klass[9];
      BK = bykva[0];

      tone(dinam, 659, 300);
      Serial.println("===========================================================================");
      Serial.println(" ");
      Serial.print(FAM);
      Serial.print(" ");
      Serial.print(IM);
      Serial.print(" ");
      Serial.print(KL);
      Serial.println(BK);
      Serial.println("");
      Serial.println("");
      Serial.println("===========================================================================");

      rfid.serNum[0] = 0;
      rfid.serNum[1] = 100;
      i1++;
      k++;
    }
  }



  if (rfid.serNum[0] == UID[1] and i2 < 2 ) {
    while (rfid.serNum[0] == UID[1] and i2 < 2) {
      FAM = "Петров" ;
      IM = "Василий";
      KL = klass[5];
      BK = bykva[1];
      Serial.println("===========================================================================");
      Serial.println(" ");
      Serial.print(FAM);
      Serial.print(" ");
      Serial.print(IM);
      Serial.print(" ");
      Serial.print(KL);
      Serial.print(BK);
      Serial.println("");
      Serial.println("");
      Serial.println("===========================================================================");
      tone(dinam, 784, 150);
      rfid.serNum[0] = 0;
      rfid.serNum[1] = 100;
      i2++;
      k++;

    }

  }
  {
    if (rfid.serNum[0] == UID[0] and i1 == 2 || rfid.serNum[0] == UID[1] and i2 == 2) {
      while (rfid.serNum[0] == UID[0] and i1 == 2 || rfid.serNum[0] == UID[1] and i2 == 2) {
        tone(dinam, 1014, 50);
        Serial.println("===========================================================================");
        Serial.println("Данная карта уже зарегистрирована сегодня");
        Serial.println("===========================================================================");

        rfid.serNum[0] = 0;
        delay(150);
      }
    }
  }





  if (rfid.serNum[0] != UID[0 or 1] and rfid.serNum[0] > 1) {
    while (rfid.serNum[0] != UID[0 or 1] and rfid.serNum[0] > 1) {
      tone(dinam, 1700, 50);
      Serial.println("===========================================================================");
      Serial.println("Данной карты не обнаружено в системе") ;
      Serial.println("===========================================================================");
      rfid.serNum[0] = 0;
    }
  }
  if (millis() - myTimer1 > 65000) {



    Serial.println(" ");
    Serial.println(" ");


    Serial.println("===========================================================================");
    Serial.println("Всего учеников пришло:");
    Serial.print(k);
    Serial.println("");

    Serial.println("===========================================================================");
    if (serNum1 < 100 and i1 == 1) {
      vg0++;
    }
    if (serNum1 < 100 and i2 == 1) {
      vg1++;
    }
    Serial.println("Ученики, которые не пришли:");
    if (serNum1 < 100 and i1 == 1) {
      Serial.println("Демченко Илья");
      Serial.println("Дней пропущено:");

      Serial.print(vg0);
      Serial.println("");
      Serial.println("===========================================================================");

    }
    if (serNum1 < 100 and i2 == 1) {

      Serial.println("Петров Василий");
      Serial.println("Дней пропущено:");

      Serial.print(vg1);

      Serial.println("");
      Serial.println("===========================================================================");
    }



    k = 0;
    i1 = 1;
    i2 = 1;
    myTimer1 = millis();

  }
}




// version 1.1


// Тестировалось на Arduino IDE 1.0.1
#include <SPI.h>
#include "DHT.h" // подключаем библиотеку
#include <RFID.h>
#define SS_PIN 10
#define RST_PIN 9
#define DHTPIN 6
#define DHTTYPE DHT11
RFID rfid(SS_PIN, RST_PIN);
uint32_t myTimer1; //Таймер
int dinam = 3;
int zvyk = 1;
int serNum0;
int serNum1;
int klass[] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11}; //0,1,2,3,4,5,6,7,8,9,10,11,12
int KL;
int i1 = 1;//Круг первого
int i2 = 1;//Круг второго
int k = 0;//Количество учеников
int UID[] = {199, 89}; //Верные айди
int vg[] = {0, 0}; //Пропуски
int vg0;
int vg1;
const char *bykva[]  = {
  "А",   // 0
  "Б",     // 1
  "В",     // 2
};

String IM;
String BK;
String FAM;

DHT dht(DHTPIN, DHTTYPE);
void setup()
{
  Serial.begin(9600);
  dht.begin(); // запускаем датчик
  SPI.begin();
  rfid.init();
  Serial.read();

}


void loop()
{



  // Если обнаружена карта
  {
    if (rfid.isCard()) {
      delay(250);

      // Считываем адрес
      if (rfid.readCardSerial()) {


        // Выводим его в порт в десятичном представлении
      }
    }
    rfid.halt();

  }
  if (rfid.serNum[0] == UID[0] and i1 < 2) {
    while (rfid.serNum[0] == UID[0] and i1 < 2) {
      FAM = "Демченко";
      IM = "Илья";
      KL = klass[9];
      BK = bykva[0];

      tone(dinam, 659, 300);
      Serial.println("===========================================================================");
      Serial.println(" ");
      Serial.print(FAM);
      Serial.print(" ");
      Serial.print(IM);
      Serial.print(" ");
      Serial.print(KL);
      Serial.println(BK);
      Serial.println("");
      Serial.println("");
      Serial.println("===========================================================================");

      rfid.serNum[0] = 0;
      rfid.serNum[1] = 100;
      i1++;
      k++;
    }
  }



  if (rfid.serNum[0] == UID[1] and i2 < 2 ) {
    while (rfid.serNum[0] == UID[1] and i2 < 2) {
      FAM = "Петров" ;
      IM = "Василий";
      KL = klass[5];
      BK = bykva[1];
      Serial.println("===========================================================================");
      Serial.println(" ");
      Serial.print(FAM);
      Serial.print(" ");
      Serial.print(IM);
      Serial.print(" ");
      Serial.print(KL);
      Serial.print(BK);
      Serial.println("");
      Serial.println("");
      Serial.println("===========================================================================");
      tone(dinam, 784, 150);
      rfid.serNum[0] = 0;
      rfid.serNum[1] = 100;
      i2++;
      k++;

    }

  }
  {
    if (rfid.serNum[0] == UID[0] and i1 == 2 || rfid.serNum[0] == UID[1] and i2 == 2) {
      while (rfid.serNum[0] == UID[0] and i1 == 2 || rfid.serNum[0] == UID[1] and i2 == 2) {
        tone(dinam, 1014, 50);
        Serial.println("===========================================================================");
        Serial.println("Данная карта уже зарегистрирована сегодня");
        Serial.println("===========================================================================");

        rfid.serNum[0] = 0;
        delay(150);
      }
    }
  }





  if (rfid.serNum[0] != UID[0 or 1] and rfid.serNum[0] > 1) {
    while (rfid.serNum[0] != UID[0 or 1] and rfid.serNum[0] > 1) {
      tone(dinam, 1700, 50);
      Serial.println("===========================================================================");
      Serial.println("Данной карты не обнаружено в системе") ;
      Serial.println("===========================================================================");
      rfid.serNum[0] = 0;
    }
  }
  if (millis() - myTimer1 > 65000) {
     Serial.println("===========================================================================");
    float h = dht.readHumidity(); // считываем влажность
  float t = dht.readTemperature(); // считываем температуру
                                 // в градусах Цельсия
 
  // проверяем полученные значения
  if (isnan(h) || isnan(t)){
    Serial.println("Ошибка чтения датчика");
    return;
  }
 
 
  // выводим полученные данные в консоль  
  Serial.print("Влажность : ");
  Serial.println(h);
 
  Serial.print("Температура: ");
  Serial.print(t);
  Serial.print(" *C, ");



    Serial.println(" ");
    Serial.println(" ");
    Serial.println("===========================================================================");


    Serial.println("===========================================================================");
    Serial.println("Всего учеников пришло:");
    Serial.print(k);
    Serial.println("");

    Serial.println("===========================================================================");
    if (serNum1 < 100 and i1 == 1) {
      vg0++;
    }
    if (serNum1 < 100 and i2 == 1) {
      vg1++;
    }
    Serial.println("Ученики, которые не пришли:");
    if (serNum1 < 100 and i1 == 1) {
      Serial.println("Демченко Илья");
      Serial.println("Дней пропущено:");

      Serial.print(vg0);
      Serial.println("");
      Serial.println("===========================================================================");

    }
    if (serNum1 < 100 and i2 == 1) {

      Serial.println("Петров Василий");
      Serial.println("Дней пропущено:");

      Serial.print(vg1);

      Serial.println("");
      Serial.println("===========================================================================");
    }



    k = 0;
    i1 = 1;
    i2 = 1;
    myTimer1 = millis();

  }
}


