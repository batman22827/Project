// Тестировалось на Arduino IDE 1.0.1
#include <SPI.h>
#include <RFID.h>
#define SS_PIN 10
#define RST_PIN 9
RFID rfid(SS_PIN, RST_PIN);
uint32_t myTimer1; //Таймер
int serNum0;
int serNum1;
int klass[] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11}; //0,1,2,3,4,5,6,7,8,9,10,11,12
int KL;
int i1 = 1;//Круг первого
int i2 = 1;//Круг второго
int k = 0;//Количество учеников
int UID[] = {199, 89}; //Верные айди
int vg[] = {0, 0}; //Пропуски
int vg0;
int vg1;
const char *bykva[]  = {
  "А",   // 0
  "Б",     // 1
  "В",     // 2
};


String IM;
String BK;
String FAM;
void setup()
{
  Serial.begin(9600);

  SPI.begin();
  rfid.init();
}

void loop()
{

  // Если обнаружена карта
  {
    if (rfid.isCard()) {
      delay(300);

      // Считываем адрес
      if (rfid.readCardSerial()) {
        delay(50);
        // Выводим его в порт в десятичном представлении
      }
    }
    rfid.halt();
    if (rfid.serNum[0] == UID[0] and i1 < 2) {
      while (rfid.serNum[0] == UID[0] and i1 < 2) {
        FAM = "Демченко";
        IM = "Илья";
        KL = klass[9];
        BK = bykva[0];
        delay(50);

        Serial.println("===========================================================================");
        Serial.println(" ");
        Serial.print(FAM);
        Serial.print(" ");
        Serial.print(IM);
        Serial.print(" ");
        Serial.print(KL);
        Serial.println(BK);
        Serial.println("");
        Serial.println("");
        Serial.println("===========================================================================");
        delay(50);
        rfid.serNum[0] = 0;
        rfid.serNum[1] = 100;
        i1++;
        k++;
      }
    }
    delay(50);

    if (rfid.serNum[0] == UID[1] and i2 < 2 ) {
      while (rfid.serNum[0] == UID[1] and i2 < 2) {
        FAM = "Петров" ;
        IM = "Василий";
        KL = klass[5];
        BK = bykva[1];
        Serial.println("===========================================================================");
        Serial.println(" ");
        Serial.print(FAM);
        Serial.print(" ");
        Serial.print(IM);
        Serial.print(" ");
        Serial.print(KL);
        Serial.print(BK);
        Serial.println("");
        Serial.println("");
        Serial.println("===========================================================================");
        delay(50);
        rfid.serNum[0] = 0;
        rfid.serNum[1] = 100;
        i2++;
        k++;

      }

    }
    {
      if (rfid.serNum[0] == UID[0] and i1 == 2 || rfid.serNum[0] == UID[1] and i2 == 2) {
        while (rfid.serNum[0] == UID[0] and i1 == 2 || rfid.serNum[0] == UID[1] and i2 == 2) {
          Serial.println("===========================================================================");
          Serial.println("Данная карта уже зарегистрирована сегодня");
          Serial.println("===========================================================================");
          delay(50);
          rfid.serNum[0] = 0;
        }
      }
    }
    if (millis() - myTimer1 >= 15000) {
      delay(50);
      Serial.println("===========================================================================");
      Serial.println("Всего учеников пришло:");
      Serial.print(k);
      Serial.println("");
      Serial.println("");
      delay(50);
      Serial.println("===========================================================================");
      if (serNum1 < 100 and i1 == 1) {
        vg0++;
      }
      if (serNum1 < 100 and i2 == 1) {
        vg1++;
      }
      Serial.println("Ученики, которые не пришли:");
      Serial.println(" ");
      if (serNum1 < 100 and i1 == 1) {
        Serial.println("Демченко Илья");
        Serial.println("Дней пропущено:");
        Serial.println("");
        Serial.print(vg0);
        Serial.println("");
        Serial.println("===========================================================================");
      }
      if (serNum1 < 100 and i2 == 1) {
        Serial.println("===========================================================================");
        Serial.println("Петров Василий");
        Serial.println("Дней пропущено:");
        Serial.print("");
        Serial.print(vg1);
        
        Serial.println("");
        Serial.println("===========================================================================");
      }



      k = 0;
      i1 = 1;
      i2 = 1;
      myTimer1 = millis();


    }
  }
}



